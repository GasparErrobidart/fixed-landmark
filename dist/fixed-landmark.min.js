"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}();function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Box=function(){function t(e){_classCallCheck(this,t),"string"==typeof e?this.dom=document.querySelector(e):"object"==(void 0===e?"undefined":_typeof(e))&&(this.dom=e),this.dom||console.error("Element ("+e+") wasn't found."),this.rect(),this.styles()}return _createClass(t,[{key:"rect",value:function(){return this.cachedRect=this.dom.getBoundingClientRect(),this.cachedRect}},{key:"styles",value:function(){return this.cachedStyles=this.dom.currentStyle||window.getComputedStyle(this.dom),this.cachedStyles}},{key:"inView",value:function(){return this.rect().bottom>=0}}]),t}(),Container=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,Box),e}(),FixedElement=function(t){function e(t){_classCallCheck(this,e);var i=t.element,o=t.container,n=t.offsetValue,s=t.offsetElement,r=t.offsetFunction,a=t.performancePriority,l=void 0===a||a,c=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i));return c.container=new Container(o),c.landmark=new Landmark(c),c.offsetValue=n||0,c.offsetElement=s,c.offsetFunction=r,c.isFixed=!1,c.performancePriority=l,c.defaultPosition=c.position(),c.defaultWidth=c.styles().defaultWidth,c.defaultPositionMargins={top:c.styles().top,right:c.styles().right,bottom:c.styles().bottom,left:c.styles().left},c.watchScroll(),c.watchResize(),c.update(),c}return _inherits(e,Box),_createClass(e,[{key:"watchResize",value:function(){this.resizeListener=window.addEventListener("resize",this.reset.bind(this))}},{key:"stopWatchResize",value:function(){window.removeEventListener("resize",this.resizeListener)}},{key:"watchScroll",value:function(){var t=this,e=void 0,i=0;this.scrollListener=window.addEventListener("scroll",(function(){if(!t.performancePriority)return t.update();i<10&&clearTimeout(e),i++,e=setTimeout((function(){t.update(),i=0}),5)}))}},{key:"stopWatchScroll",value:function(){window.removeEventListener("scroll",this.scrollListener)}},{key:"reset",value:function(){this.dom.removeAttribute("style"),this.update(),this.landmark.update()}},{key:"offset",value:function(){var t=this.offsetValue||0;return this.offsetElement&&(t+=new Box(this.offsetElement).rect().height),this.offsetFunction&&(t=this.offsetFunction(this,t)),t}},{key:"position",value:function(t){if(!t)return this.styles().position;this.dom.style.position=t}},{key:"positionMargins",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};["top","right","bottom","left"].forEach((function(i){return t.dom.style[i]=e[i]||"auto"}))}},{key:"fix",value:function(t){this.isFixed=t,this.isFixed?(this.dom.style.width=this.dom.offsetWidth+"px",this.position("fixed"),this.positionMargins(this)):(this.position(this.defaultPosition),this.positionMargins(this.defaultPositionMargins),this.dom.style.width=this.defaultWidth)}},{key:"addClasses",value:function(){var t=this,e=void 0;clearTimeout(e),e=setTimeout((function(){var e=t.isFixed?"active":"inactive",i=t.isFixed?"inactive":"active";t.dom.className=t.dom.className.replace("fixed-element-"+i,"")+" fixed-element-"+e}),5)}},{key:"update",value:function(t){var e=this.rect(),i=this.landmark.rect(),o=this.container.rect(),n=this.offset(),s=i.top<=0+n;this.top=n,this.left=o.left,o.bottom<=e.height+n&&(this.top+=o.bottom-e.height-n),this.top+="px",this.left+="px",this.landmark.isEnabled!=s&&(this.landmark.display(s),this.addClasses()),this.fix(s)}}]),e}(),Landmark=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,document.createElement("div")));return i.target=t,i.parent=t.dom.parentNode,i.update(),i.dom.classList.add("fixed-landmark"),i.parent.insertBefore(i.dom,i.target.dom),i.isEnabled=!1,i.display(!1),i}return _inherits(e,Box),_createClass(e,[{key:"display",value:function(t){this.isEnabled=t,this.dom.style.position=t?"relative":"absolute"}},{key:"update",value:function(){var t=this;this.dom.style.width=this.target.rect().width+"px",this.dom.style.height=this.target.rect().height+"px",["marginTop","marginBottom","marginLeft","marginRight"].forEach((function(e){return t.dom.style[e]=t.target.dom.style[e]}))}}]),e}();